// Fix overflow bug in token calculation
// Improve contract state management
