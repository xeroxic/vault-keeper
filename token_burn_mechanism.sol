// Bugfix: incorrect reward calculation
// Improve contract state management
